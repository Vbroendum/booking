import{j as e,M as k,G as v,t as x,w as y,r as a,x as C,v as B}from"./index-gzG90q43.js";import{T as c,C as w,I}from"./Image-DhXbnsA8.js";import{P as j}from"./index-Cvk-Z7UM.js";import{H as A}from"./Header-YHsSDmNv.js";import{F as S}from"./Footer-CXTSpyMN.js";function E({opened:n,onClose:s,onConfirm:i,title:l,bodyContent:d}){return e.jsxs(k,{opened:n,onClose:s,title:l,centered:!0,styles:{modal:{width:"500px"},closeButton:{right:"10px",top:"10px"}},children:[e.jsx("div",{style:{marginBottom:"20px"},children:d}),e.jsxs(v,{mt:"xl",justify:"flex-end",children:[e.jsx(x,{variant:"default",onClick:s,style:{marginRight:"10px"},children:"Annuller"}),e.jsx(x,{color:"red",onClick:i,children:"Bekræft"})]})]})}function M({opened:n,onClick:s}){const i=y();return e.jsxs(k,{opened:n,onClick:()=>i.navigate({to:"/startBooking"}),title:"Booking Annulleret",centered:!0,styles:{modal:{width:"500px"},closeButton:{right:"10px",top:"10px"}},children:[e.jsx(c,{style:{marginBottom:"20px"},children:"Din booking er blevet annulleret!"}),e.jsx(x,{fullWidth:!0,color:"blue",onClick:s,children:"Ny Booking"})]})}const D={margin:"20px",display:"flex",flexDirection:"row",alignItems:"center",textAlign:"left",width:"100%",padding:"10px"},R={display:"flex",flexDirection:"column",padding:"0 40px",flex:"2"},T={marginBottom:"20px",textAlign:"center"};function b({booking:n,onCancel:s}){const[i,l]=a.useState(!1),[d,r]=a.useState(!1),h=()=>l(!0),p=()=>l(!1),t=()=>{l(!1),r(!0),console.log("Canceling booking with ID:",n.id),s(n.id)},o=()=>r(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(w,{style:D,shadow:"sm",radius:"md",withBorder:!0,children:[e.jsx("div",{style:{flex:"1"},children:e.jsx(I,{src:n.image_url||"https://raw.githubusercontent.com/mantinedev/mantine/master/.demo/images/bg-8.png",height:300,fit:"cover",alt:n.lokale||"Selected Room"})}),e.jsxs("div",{style:R,children:[e.jsx("div",{style:T,children:e.jsx(c,{fw:600,size:"30px",children:"Valgt Lokale"})}),e.jsxs("div",{children:[e.jsxs(c,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Dato:"})," ",n.start_date||"Ikke angivet"]}),e.jsxs(c,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Tidspunkt:"})," ",n.start_time||"Ikke angivet"," - ",n.end_time||"Ikke angivet"]}),e.jsxs(c,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Lokale:"})," ",n.lokale||"Ikke angivet"]}),e.jsxs(c,{size:"sm",c:"dimmed",mb:"lg",children:[e.jsx("b",{children:"Antal personer:"})," ",n.number_of_people||"Ikke angivet"]})]}),e.jsx("div",{children:e.jsx(x,{color:"red",fullWidth:!0,radius:"md",onClick:h,children:"Afmeld booking"})})]})]}),e.jsx(E,{opened:i,onClose:p,onConfirm:t,title:"Er du sikker på, at du vil annullere din booking?",bodyContent:"Du skal bestille en ny tid, hvis du ombestemmer dig"}),e.jsx(M,{opened:d,onClose:o})]})}b.propTypes={booking:j.object.isRequired,onCancel:j.func.isRequired};const f=C(),O=B("/mineBookinger")({component:z});function z(){const[n,s]=a.useState([]),[i,l]=a.useState(!0),[d,r]=a.useState(null),h=y();a.useEffect(()=>{async function t(){try{const{data:{user:o},error:g}=await f.auth.getUser();if(g){console.error("Error fetching user:",g),r("Error fetching user");return}if(!o){r("No user logged in");return}console.log("Authenticated user:",o.id);const{data:u,error:m}=await f.from("bookings").select("*").eq("user_id",o.id);m?r("Error fetching bookings: "+m.message):u&&u.length===0?(console.log("Ingen bookninger fundet for denne bruger"),r("Ingen bookninger fundet")):s(u)}catch{r("An unexpected error occurred")}finally{l(!1)}}t()},[]);const p=async t=>{try{console.log("Attempting to delete booking with ID:",t);const{data:o,error:g}=await f.from("bookings").delete().eq("id",t);if(g){console.error("Error deleting booking:",g.message),r("Noget gik galt i afmeldingen ");return}console.log("Booking successfully canceled:",o),s(u=>u.filter(m=>m.id!==t))}catch(o){console.error("Unexpected error while canceling booking:",o),r("An unexpected error occurred while canceling the booking")}};return e.jsxs("div",{children:[e.jsx(A,{}),e.jsxs("div",{style:{fontSize:"25px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx("h1",{children:"Mine Bookinger"}),i&&e.jsx("p",{children:"Indlæser bookninger..."}),d&&e.jsx("p",{style:{color:"red"},children:d}),n.length===0&&!i&&!d&&e.jsx("div",{style:{textAlign:"center",marginTop:"20px"},children:e.jsx("p",{children:"Ingen bookninger fundet"})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px",justifyItems:"center",margin:"20px"},children:n.length>0?n.map(t=>e.jsx(b,{date:t.date,booking:t,onCancel:p},t.id)):e.jsx("div",{style:{gridColumn:"2",textAlign:"center",marginTop:"20px"},children:e.jsx(x,{onClick:()=>h.navigate({to:"/startBooking"}),children:"Start Booking"})})})]}),e.jsx(S,{})]})}export{O as Route,z as default};
