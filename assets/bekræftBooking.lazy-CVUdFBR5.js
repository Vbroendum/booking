import{f as I,a as T,d as R,j as e,B as L,e as E,t as U,x as w,r as d,M as P,p as v,v as _,w as z,G as M}from"./index-BltrHYVx.js";import{u as b}from"./useRouteContext-CbVfxi1g.js";import{H as O}from"./Header-FF9_8Hp5.js";import{S as q}from"./Steps-CUZu2bAA.js";import{T as n,P as u,C as D,I as N}from"./index-D3QN1bZ2.js";import{T as A}from"./Title-BaVY9o_U.js";import{F as H}from"./Footer-B3jsNOYK.js";import"./CheckIcon-DHXHE6we.js";var S={root:"m_6d731127"};const F={gap:"md",align:"stretch",justify:"flex-start"},W=E((o,{gap:g,align:i,justify:c})=>({root:{"--stack-gap":U(g),"--stack-align":i,"--stack-justify":c}})),j=I((o,g)=>{const i=T("Stack",F,o),{classNames:c,className:h,style:a,styles:f,unstyled:r,vars:l,align:p,justify:x,gap:s,variant:t,...m}=i,k=R({name:"Stack",props:i,classes:S,className:h,style:a,classNames:c,styles:f,unstyled:r,vars:l,varsResolver:W});return e.jsx(L,{ref:g,...k("root"),variant:t,...m})});j.classes=S;j.displayName="@mantine/core/Stack";const G="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23228BE6'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='feather%20feather-calendar'%3e%3crect%20x='3'%20y='4'%20width='18'%20height='18'%20rx='2'%20ry='2'%3e%3c/rect%3e%3cline%20x1='16'%20y1='2'%20x2='16'%20y2='6'%3e%3c/line%3e%3cline%20x1='8'%20y1='2'%20x2='8'%20y2='6'%3e%3c/line%3e%3cline%20x1='3'%20y1='10'%20x2='21'%20y2='10'%3e%3c/line%3e%3c/svg%3e",V="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23228BE6'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='feather%20feather-clock'%3e%3ccircle%20cx='12'%20cy='12'%20r='10'%3e%3c/circle%3e%3cpolyline%20points='12%206%2012%2012%2016%2014'%3e%3c/polyline%3e%3c/svg%3e",$="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23228BE6'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='feather%20feather-home'%3e%3cpath%20d='M3%209l9-7%209%207v11a2%202%200%200%201-2%202H5a2%202%200%200%201-2-2z'%3e%3c/path%3e%3cpolyline%20points='9%2022%209%2012%2015%2012%2015%2022'%3e%3c/polyline%3e%3c/svg%3e",J="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23228BE6'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='feather%20feather-user'%3e%3cpath%20d='M20%2021v-2a4%204%200%200%200-4-4H8a4%204%200%200%200-4%204v2'%3e%3c/path%3e%3ccircle%20cx='12'%20cy='7'%20r='4'%3e%3c/circle%3e%3c/svg%3e",K="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23228BE6'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='feather%20feather-git-pull-request'%3e%3ccircle%20cx='18'%20cy='18'%20r='3'%3e%3c/circle%3e%3ccircle%20cx='6'%20cy='6'%20r='3'%3e%3c/circle%3e%3cpath%20d='M13%206h3a2%202%200%200%201%202%202v7'%3e%3c/path%3e%3cline%20x1='6'%20y1='9'%20x2='6'%20y2='21'%3e%3c/line%3e%3c/svg%3e",B=w();function Q({lokale:o,opened:g,closeModal:i,onConfirm:c}){const[h,a]=d.useState(""),[f,r]=d.useState(!0),l=b({to:"/bekræftBooking"});return console.log(l),d.useEffect(()=>{(async()=>{const{data:x,error:s}=await B.auth.getUser();if(s||!x){console.error("Error fetching user:",(s==null?void 0:s.message)||"User not found"),a("Ukendt"),r(!1);return}console.log("Logged-in user:",x);try{const{data:t,error:m}=await B.from("userdata").select("user_id, is_teacher").eq("user_id",x.user.id).single();m?(console.error("Error fetching user data:",m.message),a("Ukendt")):(console.log("User data:",t),a(t!=null&&t.is_teacher?"Lærer":"Studerende"))}catch(t){console.error("Error during query execution:",t),a("Ukendt")}finally{r(!1)}})()},[]),f?e.jsx(n,{children:"Loading..."}):e.jsxs(P,{opened:g,onClose:i,centered:!0,size:"55rem",radius:15,title:e.jsx(n,{style:{fontWeight:"600",position:"absolute",left:"40%",top:"30%"},children:"Bekræftelse af booket lokale"}),children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4rem"},children:[e.jsxs(j,{children:[e.jsx(n,{style:{marginTop:"50px",marginLeft:"20px"},children:"Vi kan nu bekræfte at dit ønskede lokale er reserveret og booket til dig, god fornøjelse!"}),e.jsx(n,{style:{marginLeft:"20px"},children:"På undersiden “Mine Bookinger er der muligt at se din booking af lokale."})]}),e.jsx("div",{style:{justifyContent:"flex-end"},children:e.jsxs(j,{children:[e.jsx(A,{style:{marginLeft:"106px",fontWeight:"500",fontSize:"24px"},children:"Detaljer:"}),e.jsxs(n,{children:[e.jsx("img",{src:G,alt:"Calendar",style:{width:"20px",marginLeft:"80px",marginRight:"8px"}}),e.jsx("strong",{children:"Dato:"})," ",l.dateInfo.selected.toString()]}),e.jsxs(n,{children:[e.jsx("img",{src:V,alt:"Calendar",style:{width:"20px",marginLeft:"80px",marginRight:"8px"}}),e.jsx("strong",{children:"Tidspunkt:"})," ",l.startTimeInfo.startTime," - ",l.endTimeInfo.endTime]}),e.jsxs(n,{children:[e.jsx("img",{src:$,alt:"Calendar",style:{width:"20px",marginLeft:"80px",marginRight:"8px"}}),e.jsx("strong",{children:"Lokale: "})," ",o||"ikke angivet"," "]}),e.jsxs(n,{children:[e.jsx("img",{src:J,alt:"Calendar",style:{width:"20px",marginLeft:"80px",marginRight:"8px"}}),e.jsx("strong",{children:"Antal personer:"})," ",l.numberOfPeopleInfo.numberOfPeople," "]}),e.jsxs(n,{children:[e.jsx("img",{src:K,alt:"Calendar",style:{width:"20px",marginLeft:"80px",marginRight:"8px"}}),e.jsx("strong",{children:"Booket af:"})," ",h," "]})]})})]}),e.jsx(v,{style:{marginLeft:"20px",marginBottom:"20px"},onClick:c,children:"Bekræft Booking"})]})}const X=w(),Y={margin:"20px",display:"flex",flexDirection:"row",alignItems:"center",textAlign:"left",width:"100%",padding:"10px"},Z={display:"flex",flexDirection:"column",padding:"0 40px",flex:"2"},ee={marginBottom:"20px",textAlign:"center"};function C(o){const[g,i]=d.useState(!1),[c,h]=d.useState(null),a=()=>i(!0),f=()=>i(!1),r=b({to:"/bekræftBooking"});console.log(r),d.useEffect(()=>{o.lokale&&l(o.lokale)},[o.lokale]);const l=async x=>{try{const{data:s,error:t}=await X.from("lokale").select("lokaleimage").eq("lokalenr",x).single();if(t){console.error("Error fetching image:",t.message);return}s&&h(s.lokaleimage)}catch(s){console.error("Error fetching room image:",s.message)}},p=()=>{console.log("Confirming booking..."),o.onConfirmBooking(),f()};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{style:Y,shadow:"sm",radius:"md",withBorder:!0,children:[e.jsx("div",{style:{flex:"1"},children:e.jsx(N,{src:c||o.imageSrc||"",height:300,fit:"cover",alt:o.altText||"Selected Room"})}),e.jsxs("div",{style:Z,children:[e.jsx("div",{style:ee,children:e.jsx(n,{fw:600,size:"30px",children:o.title||"Valgt Lokale"})}),e.jsxs("div",{children:[e.jsxs(n,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Dato:"})," ",r.dateInfo.selected.toString()||"Ikke angivet"]}),e.jsxs(n,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Tidspunkt:"})," ",r.startTimeInfo.startTime||"Ikke angivet"," - ",r.endTimeInfo.endTime]}),e.jsxs(n,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Lokale:"})," ",o.lokale]}),e.jsxs(n,{size:"sm",c:"dimmed",mb:"lg",children:[e.jsx("b",{children:"Antal personer:"})," ",r.numberOfPeopleInfo.numberOfPeople||"Ikke angivet"]})]}),e.jsx("div",{children:e.jsx(v,{color:"blue",fullWidth:!0,radius:"md",onClick:a,children:o.buttonText||"Bekræft booking"})})]})]}),e.jsx(Q,{opened:g,closeModal:f,onConfirm:p,lokale:o.lokale})]})}C.propTypes={imageSrc:u.string,altText:u.string,title:u.string,lokale:u.string,buttonText:u.string,onConfirmBooking:u.func.isRequired};const y=w(),de=_("/bekræftBooking")({component:te});function te(){const o=z(),[g,i]=d.useState(2),[c,h]=d.useState(null),[a,f]=d.useState(""),r=b({from:"/bekræftBooking"});d.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("lokalenr");t?(h(t),l(t)):console.error("No lokalenr found in the URL")},[]);const l=async s=>{try{const{data:t,error:m}=await y.from("lokale").select("lokaleimage").eq("lokalenr",s).single();if(m){console.error("Error fetching room image:",m.message);return}t&&f(t.imageURL)}catch(t){console.error("Error fetching room image:",t.message)}},p=async()=>{try{if(!y){console.error("Supabase client is not initialized");return}const{data:{user:s},error:t}=await y.auth.getUser();if(t){console.error("Error getting user:",t.message);return}if(!s){console.error("No user is logged in");return}const{data:m,error:k}=await y.from("bookings").insert([{start_time:r.startTimeInfo.startTime,end_time:r.endTimeInfo.endTime,number_of_people:r.numberOfPeopleInfo.numberOfPeople,lokale:c,start_date:r.dateInfo.selected,user_id:s.id,lokaleimage:a}]);k?console.error("Error inserting booking:",k.message):(console.log("Booking successful:",m),o.navigate({to:"/mineBookinger"}))}catch(s){console.error("Unexpected error while booking:",s.message)}},x=()=>{console.log("Confirm booking clicked"),p()};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(O,{}),e.jsx("div",{style:{marginTop:"24px",marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsxs(M,{position:"apart",style:{width:"100%"},children:[e.jsx(v,{variant:"light",onClick:()=>o.navigate({to:"/frontpage"}),style:{margin:"0 16px"},children:"Tilbage"}),e.jsx("div",{style:{display:"flex",justifyContent:"center",width:"90%"},children:e.jsx(q,{activeStep:g,setActiveStep:i})})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",width:"100%",margin:"0 auto",flex:1},children:e.jsx("div",{style:{width:"50%",maxWidth:"90%"},children:e.jsx(C,{buttonText:"Bekræft booking",color:"blue",date:r.setDateInfo,lokale:c,time:r.setStartTimeInfo,people:r.setNumberOfPeopleInfo,imageSrc:a,onConfirmBooking:x})})}),e.jsx(H,{style:{position:"fixed",bottom:0,width:"100%",backgroundColor:"white",zIndex:1e3,padding:"10px 0"}})]})}export{de as Route,te as default};
