import{j as e,M as j,G as y,t as x,w as b,r as u,x as v,v as C}from"./index-C2Dvpb3N.js";import{T as a,C as B,I as w}from"./Image-BQdSRTNL.js";import{P as f}from"./index-DnN5Czbc.js";import{H as I}from"./Header-CioYtNSP.js";import{F as E}from"./Footer-CvyAhqND.js";function A({opened:t,onClose:s,onConfirm:i,title:l,bodyContent:c}){return e.jsxs(j,{opened:t,onClose:s,title:l,centered:!0,styles:{modal:{width:"500px"},closeButton:{right:"10px",top:"10px"}},children:[e.jsx("div",{style:{marginBottom:"20px"},children:c}),e.jsxs(y,{mt:"xl",justify:"flex-end",children:[e.jsx(x,{variant:"default",onClick:s,style:{marginRight:"10px"},children:"Annuller"}),e.jsx(x,{color:"red",onClick:i,children:"Bekræft"})]})]})}function M({opened:t,onClick:s}){const i=b();return e.jsxs(j,{opened:t,onClick:()=>i.navigate({to:"/startBooking"}),title:"Booking Annulleret",centered:!0,styles:{modal:{width:"500px"},closeButton:{right:"10px",top:"10px"}},children:[e.jsx(a,{style:{marginBottom:"20px"},children:"Din booking er blevet annulleret!"}),e.jsx(x,{fullWidth:!0,color:"blue",onClick:s,children:"Ny Booking"})]})}const S={margin:"20px",display:"flex",flexDirection:"row",alignItems:"center",textAlign:"left",width:"100%",padding:"10px"},D={display:"flex",flexDirection:"column",padding:"0 40px",flex:"2"},R={marginBottom:"20px",textAlign:"center"};function k({booking:t,onCancel:s}){const[i,l]=u.useState(!1),[c,r]=u.useState(!1),p=()=>l(!0),n=()=>l(!1),o=()=>{l(!1),r(!0),console.log("Canceling booking with ID:",t.id),s(t.id)},d=()=>r(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(B,{style:S,shadow:"sm",radius:"md",withBorder:!0,children:[e.jsx("div",{style:{flex:"1"},children:e.jsx(w,{src:t.image_url||"https://raw.githubusercontent.com/mantinedev/mantine/master/.demo/images/bg-8.png",height:300,fit:"cover",alt:t.lokale||"Selected Room"})}),e.jsxs("div",{style:D,children:[e.jsx("div",{style:R,children:e.jsx(a,{fw:600,size:"30px",children:"Valgt Lokale"})}),e.jsxs("div",{children:[e.jsxs(a,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Dato:"})," ",t.start_date||"Ikke angivet"]}),e.jsxs(a,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Tidspunkt:"})," ",t.start_time||"Ikke angivet"," - ",t.end_time||"Ikke angivet"]}),e.jsxs(a,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Lokale:"})," ",t.lokale||"Ikke angivet"]}),e.jsxs(a,{size:"sm",c:"dimmed",mb:"lg",children:[e.jsx("b",{children:"Antal personer:"})," ",t.number_of_people||"Ikke angivet"]})]}),e.jsx("div",{children:e.jsx(x,{color:"red",fullWidth:!0,radius:"md",onClick:p,children:"Afmeld booking"})})]})]}),e.jsx(A,{opened:i,onClose:n,onConfirm:o,title:"Er du sikker på, at du vil annullere din booking?",bodyContent:"Du skal bestille en ny tid, hvis du ombestemmer dig"}),e.jsx(M,{opened:c,onClose:d})]})}k.propTypes={booking:f.object.isRequired,onCancel:f.func.isRequired};const h=v(),O=C("/mineBookinger")({component:z});function z(){const[t,s]=u.useState([]),[i,l]=u.useState(!0),[c,r]=u.useState(null);u.useEffect(()=>{async function n(){try{const{data:{user:o},error:d}=await h.auth.getUser();if(d){console.error("Error fetching user:",d),r("Error fetching user");return}if(!o){r("No user logged in");return}console.log("Authenticated user:",o.id);const{data:g,error:m}=await h.from("bookings").select("*").eq("user_id",o.id);m?r("Error fetching bookings: "+m.message):g&&g.length===0?(console.log("Ingen bookninger fundet for denne bruger"),r("Ingen bookninger fundet")):s(g)}catch{r("An unexpected error occurred")}finally{l(!1)}}n()},[]);const p=async n=>{try{console.log("Attempting to delete booking with ID:",n);const{data:o,error:d}=await h.from("bookings").delete().eq("id",n);if(d){console.error("Error deleting booking:",d.message),r("Error canceling booking");return}console.log("Booking successfully canceled:",o),s(g=>g.filter(m=>m.id!==n))}catch(o){console.error("Unexpected error while canceling booking:",o),r("An unexpected error occurred while canceling the booking")}};return e.jsxs("div",{children:[e.jsx(I,{}),e.jsxs("div",{style:{fontSize:"25px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx("h1",{children:"Mine Bookinger"}),i&&e.jsx("p",{children:"Indlæser bookninger..."}),c&&e.jsx("p",{style:{color:"red"},children:c}),"  ",e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px",justifyItems:"center",margin:"20px"},children:t.length>0?t.map(n=>e.jsx(k,{date:n.date,booking:n,onCancel:p},n.id)):e.jsx("p",{})})]}),e.jsx(E,{})]})}export{O as Route,z as default};
