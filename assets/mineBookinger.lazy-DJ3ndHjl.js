import{j as e,M as j,G as y,t as x,w as b,r as u,x as v,v as C}from"./index-CXjBbQzF.js";import{T as a,C as B,I as w}from"./Image-CNtRjy3D.js";import{P as f}from"./index-TI660OPv.js";import{H as E}from"./Header-CyqWUQK3.js";import{F as I}from"./Footer-cXO7UOXG.js";function A({opened:n,onClose:s,onConfirm:i,title:l,bodyContent:d}){return e.jsxs(j,{opened:n,onClose:s,title:l,centered:!0,styles:{modal:{width:"500px"},closeButton:{right:"10px",top:"10px"}},children:[e.jsx("div",{style:{marginBottom:"20px"},children:d}),e.jsxs(y,{mt:"xl",justify:"flex-end",children:[e.jsx(x,{variant:"default",onClick:s,style:{marginRight:"10px"},children:"Annuller"}),e.jsx(x,{color:"red",onClick:i,children:"Bekræft"})]})]})}function M({opened:n,onClick:s}){const i=b();return e.jsxs(j,{opened:n,onClick:()=>i.navigate({to:"/startBooking"}),title:"Booking Annulleret",centered:!0,styles:{modal:{width:"500px"},closeButton:{right:"10px",top:"10px"}},children:[e.jsx(a,{style:{marginBottom:"20px"},children:"Din booking er blevet annulleret!"}),e.jsx(x,{fullWidth:!0,color:"blue",onClick:s,children:"Ny Booking"})]})}const S={margin:"20px",display:"flex",flexDirection:"row",alignItems:"center",textAlign:"left",width:"100%",padding:"10px"},D={display:"flex",flexDirection:"column",padding:"0 40px",flex:"2"},R={marginBottom:"20px",textAlign:"center"};function k({booking:n,onCancel:s}){const[i,l]=u.useState(!1),[d,t]=u.useState(!1),p=()=>l(!0),r=()=>l(!1),o=()=>{l(!1),t(!0),console.log("Canceling booking with ID:",n.id),s(n.id)},c=()=>t(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(B,{style:S,shadow:"sm",radius:"md",withBorder:!0,children:[e.jsx("div",{style:{flex:"1"},children:e.jsx(w,{src:n.image_url||"https://raw.githubusercontent.com/mantinedev/mantine/master/.demo/images/bg-8.png",height:300,fit:"cover",alt:n.lokale||"Selected Room"})}),e.jsxs("div",{style:D,children:[e.jsx("div",{style:R,children:e.jsx(a,{fw:600,size:"30px",children:n.lokale||"Valgt Lokale"})}),e.jsxs("div",{children:[e.jsxs(a,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Dato:"})," ",n.date||"Ikke angivet"]}),e.jsxs(a,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Tidspunkt:"})," ",n.start_time||"Ikke angivet"," - ",n.end_time||"Ikke angivet"]}),e.jsxs(a,{size:"sm",c:"dimmed",mb:"sm",children:[e.jsx("b",{children:"Lokale:"})," ",n.lokale||"Ikke angivet"]}),e.jsxs(a,{size:"sm",c:"dimmed",mb:"lg",children:[e.jsx("b",{children:"Antal personer:"})," ",n.number_of_people||"Ikke angivet"]})]}),e.jsx("div",{children:e.jsx(x,{color:"red",fullWidth:!0,radius:"md",onClick:p,children:"Afmeld booking"})})]})]}),e.jsx(A,{opened:i,onClose:r,onConfirm:o,title:"Er du sikker på, at du vil annullere din booking?",bodyContent:"Du skal bestille en ny tid, hvis du ombestemmer dig"}),e.jsx(M,{opened:d,onClose:c})]})}k.propTypes={booking:f.object.isRequired,onCancel:f.func.isRequired};const h=v(),O=C("/mineBookinger")({component:z});function z(){const[n,s]=u.useState([]),[i,l]=u.useState(!0),[d,t]=u.useState(null);u.useEffect(()=>{async function r(){try{const{data:{user:o},error:c}=await h.auth.getUser();if(c){console.error("Error fetching user:",c),t("Error fetching user");return}if(!o){t("No user logged in");return}console.log("Authenticated user:",o.id);const{data:g,error:m}=await h.from("bookings").select("*").eq("user_id",o.id);m?t("Error fetching bookings: "+m.message):g&&g.length===0?(console.log("Ingen bookninger fundet for denne bruger"),t("Ingen bookninger fundet")):s(g)}catch{t("An unexpected error occurred")}finally{l(!1)}}r()},[]);const p=async r=>{try{console.log("Attempting to delete booking with ID:",r);const{data:o,error:c}=await h.from("bookings").delete().eq("id",r);if(c){console.error("Error deleting booking:",c.message),t("Error canceling booking");return}console.log("Booking successfully canceled:",o),s(g=>g.filter(m=>m.id!==r))}catch(o){console.error("Unexpected error while canceling booking:",o),t("An unexpected error occurred while canceling the booking")}};return e.jsxs("div",{children:[e.jsx(E,{}),e.jsxs("div",{style:{fontSize:"25px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx("h1",{children:"Mine Bookinger"}),i&&e.jsx("p",{children:"Loading bookings..."}),d&&e.jsx("p",{style:{color:"red"},children:d}),"  ",e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"20px",justifyItems:"center",margin:"20px"},children:n.length>0?n.map(r=>e.jsx(k,{booking:r,onCancel:p},r.id)):e.jsx("p",{})})]}),e.jsx(I,{})]})}export{O as Route,z as default};
